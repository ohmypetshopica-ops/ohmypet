<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acceso restringido — OhMyPet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.7/dist/umd/supabase.min.js"></script>
  <script type="module" src="/assets/js/env.js"></script>
  <script type="module" src="/assets/js/supabaseClient.js"></script>
</head>
<body class="bg-gray-50 min-h-screen grid place-items-center p-6">
  <main class="w-full max-w-lg bg-white border border-gray-200 rounded-xl shadow-sm p-6 text-center space-y-4">
    <h1 class="text-2xl font-bold text-gray-800">Acceso restringido</h1>
    <p class="text-sm text-gray-600">
      No tienes permisos para ver esta página.
    </p>
    <div id="needhave" class="text-xs text-gray-500"></div>
    <div class="flex justify-center gap-3 pt-2">
      <a href="/public/dashboard.html" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Volver</a>
      <button id="btn-logout" class="px-4 py-2 rounded-lg bg-emerald-500 text-white hover:bg-emerald-600">Cerrar sesión</button>
    </div>
  </main>

  <script type="module">
    import { supabase } from '/assets/js/supabaseClient.js';

    // Muestra roles requeridos y del usuario
    const u = new URL(location.href);
    const need = u.searchParams.get('need');
    const have = u.searchParams.get('have');
    const box = document.getElementById('needhave');
    box.textContent = `Requiere: ${need || '-'} · Tus roles: ${have || '-'}`;

    // Logout seguro
    document.getElementById('btn-logout').addEventListener('click', async () => {
      try { await supabase.auth.signOut({ scope: 'global' }); } catch {}
      try {
        const del = [];
        for (let i = 0; i < localStorage.length; i++) {
          const k = localStorage.key(i);
          if (k && k.startsWith('sb-')) del.push(k);
        }
        del.forEach(k => localStorage.removeItem(k));
      } catch {}
      location.href = '/public/login.html';
    });
  </script>
</body>
</html>
