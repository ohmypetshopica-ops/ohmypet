<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Oh My Pet</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">

    <nav class="bg-white p-4 shadow-sm">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-green-600 text-2xl font-bold">OH MY PET🐾</h1>
            <div>
                <a href="productos.html" class="text-gray-600 hover:text-green-600 mx-3 font-semibold">Productos</a>
                <a href="citas.html" class="text-gray-600 hover:text-green-600 mx-3 font-semibold">Citas</a>
                
                <a href="admin-productos.html" id="admin-link" class="text-yellow-500 hover:text-yellow-600 mx-3 font-semibold hidden">👑 Admin</a>
                
                <a href="#" id="logout-button" class="text-gray-600 hover:text-green-600 mx-3 font-semibold">Cerrar Sesión</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-6">
        <h1 id="welcome-message" class="text-4xl font-bold text-gray-800">Cargando...</h1>
    </main>

    <script type="module" src="supabase-client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { user } } = await supabase.auth.getUser();

            if (!user) {
                alert('Necesitas iniciar sesión para acceder a esta página.');
                window.location.href = 'login.html';
                return; 
            }

            const { data: roleData, error: roleError } = await supabase
                .from('user_roles')
                .select('role')
                .eq('user_id', user.id)
                .single();

            if (!roleError && roleData && ['dueno', 'empleado'].includes(roleData.role)) {
                const adminLink = document.querySelector('#admin-link');
                if (adminLink) {
                    adminLink.classList.remove('hidden');
                }
            }

            const userName = user.user_metadata.nombre;
            const welcomeMessageElement = document.querySelector('#welcome-message');
            if (userName) {
                welcomeMessageElement.textContent = `¡Bienvenido de vuelta, ${userName}!`;
            } else {
                welcomeMessageElement.textContent = '¡Bienvenido!';
            }
            
            const logoutButton = document.querySelector('#logout-button');
            logoutButton.addEventListener('click', async (event) => {
                event.preventDefault();
                const { error } = await supabase.auth.signOut();
                if (error) {
                    alert(`Error al cerrar sesión: ${error.message}`);
                } else {
                    // --- CAMBIO: Alerta eliminada ---
                    window.location.href = 'login.html';
                }
            });
        });
    </script>
</body>
</html>